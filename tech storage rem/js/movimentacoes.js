async function jsonReq(url,data){ const res = await fetch(url,{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data), credentials:'include'}); return res.json(); }
export async function getMovimentacoes(){ const r = await fetch('/api/movimentacoes_read.php',{credentials:'include'}); return r.json(); }
export async function createMovimentacao(data){ return jsonReq('/api/movimentacoes_create.php', data); }
window.showAddMov = function(){ document.getElementById('addMovForm').style.display='block'; }
window.addMov = async function(){ const tipo=document.getElementById('movTipo').value; const prod=parseInt(document.getElementById('movProduto').value||0); const origem=document.getElementById('movOrigem').value||null; const destino=document.getElementById('movDestino').value||null; const qtd=parseFloat(document.getElementById('movQuantidade').value||0); const obs=document.getElementById('movObs').value||null; const resp = await createMovimentacao({tipo,id_produto:prod,id_local_origem:origem||null,id_local_destino:destino||null,quantidade:qtd,observacao:obs}); if(resp.success){ alert('Movimentação registrada'); location.reload(); } else alert('Erro: '+JSON.stringify(resp)); }
window.loadMov = async function(){ const r = await getMovimentacoes(); const t = document.getElementById('movList'); if(!t) return; t.innerHTML=''; r.movimentacoes.forEach(m=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${m.id_mov}</td><td>${m.tipo}</td><td>${m.produto_nome}</td><td>${m.quantidade}</td><td>${m.usuario_nome}</td><td>${m.realizado_em}</td>`; t.appendChild(tr); }); }
window.addEventListener('DOMContentLoaded', window.loadMov);
